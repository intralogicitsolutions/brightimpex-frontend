<div [@fadeAnimation]="'/catalogue'" class="flex flex-col">
    <div class="header-section">
        <div class="text">
            products
        </div>
        <div class="sub-text">
            <a routerLink="/home">Home</a>
            <img src="assets/icons/chevron-right.svg" alt="" class="mx-1 h-5 icon">
            <span class="bold-font">Products</span>
        </div>
    </div>
    <div class="flex flex-col catalogue-container">
        @if (isMobileView()) {
        <div class="w-full flex flex-col">
            <div class="category-tabs">
                <mat-tab-group [(selectedIndex)]="selectedCategoryIndex"
                    (selectedIndexChange)="onCategoryChange($event)">

                    @for (category of catalogueCatagories(); track category?._id; let index = $index) {
                    <mat-tab [label]="category?.name">
                        <ng-template mat-tab-label>
                            <div (click)="(isAdmin() && category?._id !== 'all') && openCategoryDialog(category)">
                                {{category?.name}}
                            </div>
                        </ng-template>
                    </mat-tab>
                    }

                    @if (isAdmin()) {
                    <mat-tab>
                        <ng-template mat-tab-label>
                            <div (click)="openCategoryDialog()">
                                <mat-icon>add</mat-icon>
                            </div>
                        </ng-template>
                    </mat-tab>
                    }
                </mat-tab-group>
            </div>
            <div class="w-full flex justify-between pt-6 pb-4 border-b-primary">
                <span class="sans-medium text-sm">{{catalogueProductLength}} {{catalogueProductLength > 1 ? 'PRODUCTS' :
                    'PRODUCT'}}</span>
                <span class="underline text-primary text-sm sans-medium" (click)="toggleFilter()">Filter</span>
            </div>
        </div>
        } @else {
        <div class="flex justify-between w-full h-16 items-center text-primary">
            @for (category of catalogueCatagories(); track $index) {
            <a [routerLink]="'/catalogue/' + category?._id" routerLinkActive="active-catalogue" class="catalogue-menu"
                (click)="isAdmin() && category?._id !== 'all' && openCategoryDialog(category)">{{category?.name}}</a>
            }

            @if (isAdmin()) {
            <a class="catalogue-menu cursor-pointer" (click)="openCategoryDialog()">
                <mat-icon>add</mat-icon>
            </a>
            }
        </div>
        }
        <div class="flex w-full pt-8">
            <div class="mb-2 sidebar-filter">
                <div class="flex flex-col text-primary border-r-primary w-full">
                    <div class="mb-2">
                        <div class="w-full border-b-primary pb-2">SEARCH SIZE</div>
                        <div class="flex flex-col w-full pt-2">
                            @for (size of filteredCatalogueSizes(); track size?._id) {
                            <div (click)="isAdmin() && openSizeDialog(size)" [ngClass]="{'cursor-pointer': isAdmin()}">
                                <mat-checkbox color="primary" class="filter-checkbox" [(ngModel)]="size.checked"
                                    (change)="changeSize()" [disabled]="size?.disabled">
                                    {{size?.height}} X {{size?.width}} {{size?.unit}}
                                </mat-checkbox>
                            </div>
                            }

                            @if (isAdmin()) {
                            <button mat-button color="primary" class="outline-add-btn mt-3" (click)="openSizeDialog()">
                                <mat-icon class="m-0">add</mat-icon>
                            </button>
                            }
                        </div>
                    </div>
                    <div class="mt-4 mb-2">
                        <div class="w-full border-b-primary pb-2">SERIES</div>
                        <div class="flex flex-col w-full pt-2">
                            @for (series of filteredCatalogueSeries(); track series?._id) {
                            <div (click)="isAdmin() && openSeriesDialog(series)"
                                [ngClass]="{'cursor-pointer': isAdmin()}">
                                <mat-checkbox color="primary" class="filter-checkbox" [(ngModel)]="series.checked"
                                    (change)="changeSeries()"
                                    [disabled]="series?.disabled">{{series?.name}}</mat-checkbox>
                            </div>
                            }

                            @if (isAdmin()) {
                            <button mat-button color="primary" class="outline-add-btn mt-3"
                                (click)="openSeriesDialog()">
                                <mat-icon class="m-0">add</mat-icon>
                            </button>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-wrap catalogues-list">
                @for (catalogue of filteredCatalogues().slice(0, this.loadedCataloguesCount()); track catalogue?._id) {
                @if (!catalogue?.isHiddenBySize && !catalogue?.isHiddenBySeries) {
                <div class="catalogue" (click)="isAdmin() && openCatalogueDialog(catalogue)"
                    [ngClass]="{'cursor-pointer': isAdmin()}">
                    <div class="group relative overflow-hidden">
                        <img [ngSrc]="serverUrl + catalogue?.image" width="210" height="324" alt=""
                            class="catalogue-img w-full"
                            [ngClass]="{'transition-tramsform duration-500 ease-in-out group-hover:scale-110 group-hover:blur-sm': !isMobileView()}" />

                        @if (!isMobileView()) {
                        <div
                            class="absolute inset-0 flex items-center justify-center px-4 opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                            <button
                                (click)="onPreview(catalogue?.catalogue_doc); (isAdmin() && $event.stopPropagation())"
                                class="text-white py-2 mx-2 rounded-md transform -translate-x-full group-hover:translate-x-0 transition-transform duration-500">
                                <img src="assets/icons/preview.svg" alt="" class="w-14 h-14">
                            </button>
                            <button
                                (click)="onDownload(catalogue?.catalogue_doc, catalogue?.name); (isAdmin() && $event.stopPropagation())"
                                class="text-white py-2 mx-2 rounded-md transform translate-x-full group-hover:translate-x-0 transition-transform duration-500">
                                <img src="assets/icons/download.svg" alt="" class="w-14 h-14">
                            </button>
                        </div>
                        }
                    </div>
                    <div class="flex flex-col w-full pt-2">
                        <span class="name">{{catalogue?.name}}</span>
                        <span class="info">
                            <span>{{catalogue?.size}}</span>
                            <span class="bullet"></span>
                            <span>{{catalogue?.series_id?.name}}</span>
                        </span>
                        @if (isMobileView()) {
                        <div class="info">
                            <span class="underline text-primary sans-medium"
                                (click)="onPreview(catalogue?.catalogue_doc)">View</span>
                            <span class="bullet"></span>
                            <span class="underline text-primary sans-medium"
                                (click)="onDownload(catalogue?.catalogue_doc, catalogue?.name)">Download</span>
                        </div>
                        }
                    </div>
                </div>
                }
                }

                @if (isAdmin()) {
                <div class="catalogue flex justify-center items-center cursor-pointer add-catalogue-btn"
                    (click)="openCatalogueDialog()">
                    <mat-icon class="add-catalogue-icon">add</mat-icon>
                </div>
                }
            </div>
        </div>
        @if (isMobileView()) {
        <div class="w-full flex justify-center flex-col items-center py-12">
            @if (this.loadedCataloguesCount() < this.filteredCatalogues().length) { <button mat-flat-button
                color="primary" class="primary-btn" (click)="loadMoreCatalogues()">
                Load More
                </button>
                }
                <span class="pt-2 text-sm">Couldn’t find what you’re looking for?</span>
                <a routerLink="/contact-us" class="underline text-primary text-sm flex items-center pt-2 sans-medium">
                    Contact Us
                </a>
        </div>
        }
    </div>

    @if (isMobileView()) {
    <!-- Background Overlay (Blurred) -->
    <div class="fixed inset-0 transition-opacity duration-300 ease-in-out z-10"
        [ngClass]="{'opacity-100 visible': isFilterOpened, 'opacity-0 invisible': !isFilterOpened}"
        (click)="toggleFilter()" style="background: #0000005C;">
    </div>

    <!-- Filter Panel -->
    <div class="fixed bottom-0 left-0 w-full bg-white shadow-lg border-t border-gray-300 
        transition-transform duration-300 ease-in-out transform z-20 filter-panel" [ngClass]="{
        'translate-y-0 pointer-events-auto': isFilterOpened, 
        'translate-y-full pointer-events-none': !isFilterOpened
    }">
        <div class="catalogue-filter w-full h-fit p-4 overflow-auto">
            <div class="flex justify-center relative pt-4 pb-6">
                <span class="text-lg sans-medium text-primary text-center">Filter</span>
                <mat-icon (click)="toggleFilter()" class="absolute right-2 text-primary">close</mat-icon>
            </div>
            <div class="flex flex-col">
                <span class="text-base sans-medium text-primary text-center border-b-primary pb-4">SEARCH SIZE</span>
                <div class="flex flex-wrap w-full pt-4">
                    @for (size of filteredCatalogueSizes(); track size?._id) {
                    <div class="w-1/2" (click)="isAdmin() && openSizeDialog(size)"
                        [ngClass]="{'cursor-pointer': isAdmin()}">
                        <mat-checkbox color="primary" class="filter-checkbox" [(ngModel)]="size.checked"
                            (change)="changeSize()" [disabled]="size?.disabled">{{size?.height}} X {{size?.width}}
                            {{size?.unit}}
                        </mat-checkbox>
                    </div>
                    }

                    @if (isAdmin()) {
                    <div class="w-full">
                        <button mat-button color="primary" class="outline-add-btn mt-3" (click)="openSizeDialog()">
                            <mat-icon class="m-0">add</mat-icon>
                        </button>
                    </div>
                    }
                </div>

                <span class="text-base sans-medium text-primary text-center border-b-primary pb-4 pt-6">SERIES</span>
                <div class="flex flex-wrap w-full pt-4">
                    @for (series of filteredCatalogueSeries(); track series?._id) {
                    <div class="w-1/2" (click)="isAdmin() && openSeriesDialog(series)"
                        [ngClass]="{'cursor-pointer': isAdmin()}">
                        <mat-checkbox color="primary" class="filter-checkbox" [(ngModel)]="series.checked"
                            (change)="changeSeries()" [disabled]="series?.disabled">{{series?.name}}
                        </mat-checkbox>
                    </div>
                    }

                    @if (isAdmin()) {
                    <div class="w-full">
                        <button mat-button color="primary" class="outline-add-btn mt-3" (click)="openSeriesDialog()">
                            <mat-icon class="m-0">add</mat-icon>
                        </button>
                    </div>
                    }
                </div>

                <div class="text-center py-6">
                    <button mat-flat-button color="primary" class="primary-btn min-w-28"
                        (click)="toggleFilter()">Apply</button>
                </div>
            </div>
        </div>
    </div>
    }
</div>

<ng-template #CategoryTemplate>
    <div class="w-full h-full flex flex-col">
        <div class="py-3 mb-4 pl-6 pr-4 dialog-header">
            <span class="text-white text-xl sm-medium">
                {{selectedCategory() ? 'Modify Category' : 'Add Category'}}
            </span>
            <button mat-icon-button mat-dialog-close type="button" style="color: white;">
                <mat-icon style="height: 26px;">close</mat-icon>
            </button>
        </div>
        <form [formGroup]="categoryForm" class="px-6" (ngSubmit)="onSubmitCategory()">
            <div class="w-full flex flex-col pt-4">
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Category Name</mat-label>
                    <input matInput type="text" formControlName="name">
                    @if (categoryForm.get('name')?.hasError('required')) {
                    <mat-error>Category name is required</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full pt-4">
                    <mat-label>Category Description</mat-label>
                    <textarea matInput formControlName="description" rows="5"></textarea>
                </mat-form-field>

                <div class="w-full flex justify-between pb-4">
                    <span>
                        @if (selectedCategory()) {
                        <button mat-flat-button type="button" class="delete-btn"
                            (click)="deleteCategory()">Delete</button>
                        }
                    </span>
                    <span>
                        <button mat-dialog-close mat-flat-button type="button" class="cancel-btn ml-2">Cancel</button>
                        <button mat-flat-button type="submit" class="submit-btn ml-2">Submit</button>
                    </span>
                </div>
            </div>
        </form>
    </div>
</ng-template>

<ng-template #SizeTemplate>
    <div class="w-full h-full flex flex-col">
        <div class="py-3 mb-4 pl-6 pr-4 dialog-header">
            <span class="text-white text-xl sm-medium">
                {{selectedSize() ? 'Modify Size' : 'Add Size'}}
            </span>
            <button mat-icon-button mat-dialog-close type="button" style="color: white;">
                <mat-icon style="height: 26px;">close</mat-icon>
            </button>
        </div>
        <form [formGroup]="sizeForm" class="px-6" (ngSubmit)="onSubmitSize()">
            <div class="w-full flex flex-col pt-4">
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Height</mat-label>
                    <input matInput type="number" formControlName="height">
                    @if (sizeForm.get('height')?.hasError('required')) {
                    <mat-error>Height is required</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full pt-4">
                    <mat-label>Width</mat-label>
                    <input matInput type="number" formControlName="width">
                    @if (sizeForm.get('width')?.hasError('required')) {
                    <mat-error>Width is required</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full pt-4">
                    <mat-label>Unit</mat-label>
                    <input matInput type="text" formControlName="unit">
                    @if (sizeForm.get('unit')?.hasError('required')) {
                    <mat-error>Unit is required</mat-error>
                    }
                </mat-form-field>

                <div class="w-full flex justify-between pb-4">
                    <span>
                        @if (selectedSize()) {
                        <button mat-flat-button type="button" class="delete-btn" (click)="deleteSize()">Delete</button>
                        }
                    </span>
                    <span>
                        <button mat-dialog-close mat-flat-button type="button" class="cancel-btn ml-2">Cancel</button>
                        <button mat-flat-button type="submit" class="submit-btn ml-2">Submit</button>
                    </span>
                </div>
            </div>
        </form>
    </div>
</ng-template>

<ng-template #SeriesTemplate>
    <div class="w-full h-full flex flex-col">
        <div class="py-3 mb-4 pl-6 pr-4 dialog-header">
            <span class="text-white text-xl sm-medium">
                {{selectedSeries() ? 'Modify Series' : 'Add Series'}}
            </span>
            <button mat-icon-button mat-dialog-close type="button" style="color: white;">
                <mat-icon style="height: 26px;">close</mat-icon>
            </button>
        </div>
        <form [formGroup]="seriesForm" class="px-6" (ngSubmit)="onSubmitSeries()">
            <div class="w-full flex flex-col pt-4">
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Series Name</mat-label>
                    <input matInput type="text" formControlName="name">
                    @if (categoryForm.get('name')?.hasError('required')) {
                    <mat-error>Series name is required</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full pt-4">
                    <mat-label>Series Description</mat-label>
                    <textarea matInput formControlName="description" rows="5"></textarea>
                </mat-form-field>

                <div class="w-full flex justify-between pb-4">
                    <span>
                        @if (selectedSeries()) {
                        <button mat-flat-button type="button" class="delete-btn"
                            (click)="deleteSeries()">Delete</button>
                        }
                    </span>
                    <span>
                        <button mat-dialog-close mat-flat-button type="button" class="cancel-btn ml-2">Cancel</button>
                        <button mat-flat-button type="submit" class="submit-btn ml-2">Submit</button>
                    </span>
                </div>
            </div>
        </form>
    </div>
</ng-template>

<ng-template #CatalogueTemplate>
    <div class="w-full h-full flex flex-col">
        <div class="py-3 mb-4 pl-6 pr-4 dialog-header">
            <span class="text-white text-xl sm-medium">
                {{selectedCatalogue() ? 'Modify Catalogue' : 'Add Catalogue'}}
            </span>
            <button mat-icon-button mat-dialog-close type="button" style="color: white;">
                <mat-icon style="height: 26px;">close</mat-icon>
            </button>
        </div>
        <form [formGroup]="catalogueForm" class="px-6" (ngSubmit)="onSubmitCatalogue()">
            <div class="w-full flex flex-col">
                <div class="flex flex-wrap pt-4">
                    <div class="w-1/2 px-2">
                        <mat-form-field appearance="outline" class="w-full">
                            <mat-label>Catalogue Name</mat-label>
                            <input matInput type="text" formControlName="name">
                            @if (catalogueForm.get('name')?.hasError('required')) {
                            <mat-error>Catalogue name is required</mat-error>
                            }
                        </mat-form-field>
                    </div>
                    <div class="w-1/2 px-2">
                        <mat-form-field appearance="outline" class="w-full">
                            <mat-label>Catalogue Category</mat-label>
                            <mat-select formControlName="category_id">
                                @for (catalogue of catalogueCatagories(); track catalogue?._id) {
                                @if (catalogue?._id !== 'all') {
                                <mat-option [value]="catalogue?._id">{{catalogue?.name}}</mat-option>
                                }
                                }
                            </mat-select>
                            @if (catalogueForm.get('category_id')?.hasError('required')) {
                            <mat-error>Catalogue category is required</mat-error>
                            }
                        </mat-form-field>
                    </div>
                </div>

                <div class="flex flex-wrap px-2 pt-4">
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Series Description</mat-label>
                        <textarea matInput formControlName="description" rows="3"></textarea>
                    </mat-form-field>
                </div>

                <div class="flex flex-wrap pt-4">
                    <div class="w-1/2 px-2">
                        <mat-form-field appearance="outline" class="w-full">
                            <mat-label>Catalogue Size</mat-label>

                            <mat-select formControlName="size_id">
                                @for (size of catalogueSizes(); track size?._id) {
                                <mat-option [value]="size?._id">
                                    {{size?.height}} X {{size?.width}} {{size?.unit}}
                                </mat-option>
                                }
                            </mat-select>

                            @if (catalogueForm.get('size_id')?.hasError('required')) {
                            <mat-error>Catalogue size is required</mat-error>
                            }
                        </mat-form-field>
                    </div>
                    <div class="w-1/2 px-2">
                        <mat-form-field appearance="outline" class="w-full">
                            <mat-label>Catalogue Series</mat-label>

                            <mat-select formControlName="series_id">
                                @for (series of catalogueSeries(); track series?._id) {
                                <mat-option [value]="series?._id">{{series?.name}}</mat-option>
                                }
                            </mat-select>

                            @if (catalogueForm.get('series_id')?.hasError('required')) {
                            <mat-error>Catalogue series is required</mat-error>
                            }
                        </mat-form-field>
                    </div>
                </div>

                <div class="flex flex-wrap pt-4">
                    <div class="w-1/2 px-2">
                        <input #catalogueImage type="file" class="hidden">
                        <mat-form-field appearance="outline" class="w-full">
                            <mat-label>Catalogue Image</mat-label>
                            <input matInput type="text" formControlName="image">
                            <button matSuffix mat-icon-button aria-label="Upload" type="button" class="mr-2"
                                (click)="catalogueImage.click()">
                                <mat-icon>upload</mat-icon>
                            </button>
                            @if (catalogueForm.get('image')?.hasError('required')) {
                            <mat-error>Catalogue image is required</mat-error>
                            }
                        </mat-form-field>
                    </div>
                    <div class="w-1/2 px-2">
                        <input #catalogueDoc type="file" class="hidden">
                        <mat-form-field appearance="outline" class="w-full">
                            <mat-label>Catalogue Document</mat-label>
                            <input matInput type="text" formControlName="catalogue_doc">
                            <button matSuffix mat-icon-button aria-label="Upload" type="button"
                                (click)="catalogueDoc.click()" class="mr-2">
                                <mat-icon>upload</mat-icon>
                            </button>
                            @if (catalogueForm.get('catalogue_doc')?.hasError('required')) {
                            <mat-error>Catalogue Document is required</mat-error>
                            }
                        </mat-form-field>
                    </div>
                </div>

                <div class="w-full flex justify-between pb-4">
                    <span>
                        @if (selectedCatalogue()) {
                        <button mat-flat-button type="button" class="delete-btn"
                            (click)="deleteCatalogue()">Delete</button>
                        }
                    </span>
                    <span>
                        <button mat-dialog-close mat-flat-button type="button" class="cancel-btn ml-2">Cancel</button>
                        <button mat-flat-button type="submit" class="submit-btn ml-2">Submit</button>
                    </span>
                </div>
            </div>
        </form>
    </div>
</ng-template>